TITLE: BUG: soft lockup in snd_rawmidi_write
ALT: stall in snd_rawmidi_write
TYPE: HANG

[  352.504666] watchdog: BUG: soft lockup - CPU#1 stuck for 134s! [syz-executor2:10431]
[  352.512610] Modules linked in:
[  352.515804] irq event stamp: 35856
[  352.519353] hardirqs last  enabled at (35855): [<ffffffff874a1734>] _raw_spin_unlock_irqrestore+0x74/0xc0
[  352.529060] hardirqs last disabled at (35856): [<ffffffff87600901>] interrupt_entry+0xb1/0xf0
[  352.537731] softirqs last  enabled at (162): [<ffffffff87800778>] __do_softirq+0x778/0xaf5
[  352.546142] softirqs last disabled at (95): [<ffffffff81467a61>] irq_exit+0x1d1/0x200
[  352.554114] CPU: 1 PID: 10431 Comm: syz-executor2 Not tainted 4.16.0+ #4
[  352.561560] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
[  352.570920] RIP: 0010:_raw_spin_unlock_irqrestore+0xa1/0xc0
[  352.576631] RSP: 0018:ffff880184db7780 EFLAGS: 00000282 ORIG_RAX: ffffffffffffff13
[  352.584344] RAX: dffffc0000000000 RBX: 0000000000000282 RCX: 0000000000000000
[  352.591613] RDX: 1ffffffff1162e55 RSI: 0000000000000001 RDI: 0000000000000282
[  352.598881] RBP: ffff880184db7790 R08: ffffed0035d21962 R09: 0000000000000000
[  352.606150] R10: 0000000000000000 R11: 0000000000000000 R12: ffff8801ae90cb08
[  352.613418] R13: ffff880184db7810 R14: 0000000000000001 R15: ffff8801cb9a5880
[  352.620696] FS:  00007fc943ad8700(0000) GS:ffff8801db100000(0000) knlGS:0000000000000000
[  352.628921] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  352.634800] CR2: 00007fc943ad7db8 CR3: 00000001b070d000 CR4: 00000000001406e0
[  352.642074] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[  352.649346] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[  352.656610] Call Trace:
[  352.659210]  snd_virmidi_output_trigger+0x522/0x6c0
[  352.674379]  snd_rawmidi_kernel_write1+0x519/0x700
[  352.679328]  snd_rawmidi_write+0x2e2/0xdc0
[  352.703684]  __vfs_write+0x10b/0x880
[  352.751248]  vfs_write+0x1f8/0x560
[  352.754805]  ksys_write+0xf9/0x250
[  352.770317]  SyS_write+0x24/0x30
[  352.777491]  do_syscall_64+0x29e/0x9d0
[  352.810491]  entry_SYSCALL_64_after_hwframe+0x42/0xb7
[  352.815683] RIP: 0033:0x455259
[  352.818870] RSP: 002b:00007fc943ad7c68 EFLAGS: 00000246 ORIG_RAX: 0000000000000001
[  352.826582] RAX: ffffffffffffffda RBX: 00007fc943ad86d4 RCX: 0000000000455259
[  352.833855] RDX: 00000000e78e624c RSI: 0000000020000040 RDI: 0000000000000014
[  352.841123] RBP: 000000000072c010 R08: 0000000000000000 R09: 0000000000000000
[  352.848390] R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
[  352.855661] R13: 00000000000006ca R14: 00000000006fd390 R15: 0000000000000002
[  352.882430] Kernel panic - not syncing: softlockup: hung tasks
[  352.888409] CPU: 1 PID: 10431 Comm: syz-executor2 Tainted: G             L   4.16.0+ #4
[  352.896551] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
[  352.905898] Call Trace:
[  352.908475]  <IRQ>
[  352.910636]  dump_stack+0x1b9/0x294
[  352.927344]  panic+0x22f/0x4de
[  352.953918]  watchdog_timer_fn.cold.5+0xf3/0x126
[  352.958685]  __hrtimer_run_queues+0x3e3/0x10a0
[  353.006124]  hrtimer_interrupt+0x286/0x650
[  353.010381]  smp_apic_timer_interrupt+0x15d/0x710
[  353.027757] INFO: rcu_sched detected stalls on CPUs/tasks:
[  353.029387] 	1-....: (1 GPs behind) idle=7a2/1/4611686018427387906 softirq=35919/35920 fqs=20 
[  353.034918]  apic_timer_interrupt+0xf/0x20
[  353.034924]  </IRQ>
[  353.034937] RIP: 0010:_raw_spin_unlock_irqrestore+0xa1/0xc0
[  353.039231] 	
[  353.047962] RSP: 0018:ffff880184db7780 EFLAGS: 00000282
[  353.051471] (detected by 0, t=125014 jiffies, g=19098, c=19097, q=977)
[  353.051482] Sending NMI from CPU 0 to CPUs 1:
[  353.056298]  ORIG_RAX: ffffffffffffff13
[  353.056309] RAX: dffffc0000000000 RBX: 0000000000000282 RCX: 0000000000000000
[  353.062594] NMI backtrace for cpu 1
[  353.062600] CPU: 1 PID: 10431 Comm: syz-executor2 Tainted: G             L   4.16.0+ #4
[  353.062606] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
[  353.062611] RIP: 0010:__sanitizer_cov_trace_const_cmp4+0x16/0x20
[  353.062616] RSP: 0018:ffff8801db107080 EFLAGS: 00000006
[  353.062623] RAX: 0000000000010003 RBX: ffff8801db1071aa RCX: ffffffff87462c86
[  353.062629] RDX: 0000000000000003 RSI: 0000000000000009 RDI: 0000000000000005
[  353.062634] RBP: ffff8801db107080 R08: ffff8801894c8440 R09: fffffbfff148ee7c
[  353.062639] R10: fffffbfff148ee7c R11: ffffffff8a4773e0 R12: 0000000000000003
[  353.062644] R13: 0000000000003033 R14: 000000000000000a R15: ffffffff8a4773e1
[  353.062650] FS:  00007fc943ad8700(0000) GS:ffff8801db100000(0000) knlGS:0000000000000000
[  353.062654] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  353.062659] CR2: 00007fc943ad7db8 CR3: 00000001b070d000 CR4: 00000000001406e0
[  353.062665] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[  353.062670] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[  353.062673] Call Trace:
[  353.062675]  <IRQ>
[  353.062679]  put_dec_trunc8+0x266/0x300
[  353.062682]  put_dec+0x3b/0xf0
[  353.062686]  number+0xb94/0xc90
[  353.062704]  vsnprintf+0x13a5/0x1b40
[  353.062711]  sprintf+0xa7/0xd0
[  353.062718]  print_prefix+0x26a/0x3f0
[  353.062721]  msg_print_text+0xca/0x1c0
[  353.062725]  console_unlock+0x4f5/0x1100
[  353.062751]  vprintk_emit+0x6ad/0xdd0
[  353.062773]  vprintk_default+0x28/0x30
[  353.062777]  vprintk_func+0x7a/0xe7
[  353.062780]  printk+0x9e/0xba
[  353.062791]  __show_regs.cold.7+0x86/0x54a
[  353.062799]  show_regs_if_on_stack.constprop.7+0x36/0x39
[  353.062803]  show_trace_log_lvl+0x120/0x25c
[  353.062811]  show_stack+0x38/0x3a
[  353.062814]  dump_stack+0x1b9/0x294
[  353.062829]  panic+0x22f/0x4de
[  353.062853]  watchdog_timer_fn.cold.5+0xf3/0x126
[  353.062857]  __hrtimer_run_queues+0x3e3/0x10a0
[  353.062898]  hrtimer_interrupt+0x286/0x650
[  353.062903]  smp_apic_timer_interrupt+0x15d/0x710
[  353.062930]  apic_timer_interrupt+0xf/0x20
[  353.062932]  </IRQ>
[  353.062937] RIP: 0010:_raw_spin_unlock_irqrestore+0xa1/0xc0
[  353.062941] RSP: 0018:ffff880184db7780 EFLAGS: 00000282 ORIG_RAX: ffffffffffffff13
[  353.062950] RAX: dffffc0000000000 RBX: 0000000000000282 RCX: 0000000000000000
[  353.062955] RDX: 1ffffffff1162e55 RSI: 0000000000000001 RDI: 0000000000000282
[  353.062960] RBP: ffff880184db7790 R08: ffffed0035d21962 R09: 0000000000000000
[  353.062965] R10: 0000000000000000 R11: 0000000000000000 R12: ffff8801ae90cb08
[  353.062971] R13: ffff880184db7810 R14: 0000000000000001 R15: ffff8801cb9a5880
[  353.062975]  snd_virmidi_output_trigger+0x522/0x6c0
[  353.062987]  snd_rawmidi_kernel_write1+0x519/0x700
[  353.062991]  snd_rawmidi_write+0x2e2/0xdc0
[  353.063017]  __vfs_write+0x10b/0x880
[  353.063059]  vfs_write+0x1f8/0x560
[  353.063062]  ksys_write+0xf9/0x250
[  353.063076]  SyS_write+0x24/0x30
[  353.063084]  do_syscall_64+0x29e/0x9d0
[  353.063112]  entry_SYSCALL_64_after_hwframe+0x42/0xb7
[  353.063115] RIP: 0033:0x455259
[  353.063119] RSP: 002b:00007fc943ad7c68 EFLAGS: 00000246 ORIG_RAX: 0000000000000001
[  353.063128] RAX: ffffffffffffffda RBX: 00007fc943ad86d4 RCX: 0000000000455259
[  353.063134] RDX: 00000000e78e624c RSI: 0000000020000040 RDI: 0000000000000014
[  353.063139] RBP: 000000000072c010 R08: 0000000000000000 R09: 0000000000000000
[  353.063144] R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
[  353.063149] R13: 00000000000006ca R14: 00000000006fd390 R15: 0000000000000002
[  353.765584] RDX: 1ffffffff1162e55 RSI: 0000000000000001 RDI: 0000000000000282
[  353.772854] RBP: ffff880184db7790 R08: ffffed0035d21962 R09: 0000000000000000
[  353.780122] R10: 0000000000000000 R11: 0000000000000000 R12: ffff8801ae90cb08
[  353.787390] R13: ffff880184db7810 R14: 0000000000000001 R15: ffff8801cb9a5880
[  353.794699]  snd_virmidi_output_trigger+0x522/0x6c0
[  353.809878]  snd_rawmidi_kernel_write1+0x519/0x700
[  353.814825]  snd_rawmidi_write+0x2e2/0xdc0
[  353.839166]  __vfs_write+0x10b/0x880
[  353.886693]  vfs_write+0x1f8/0x560
[  353.890241]  ksys_write+0xf9/0x250
[  353.905722]  SyS_write+0x24/0x30
[  353.912894]  do_syscall_64+0x29e/0x9d0
[  353.945884]  entry_SYSCALL_64_after_hwframe+0x42/0xb7
[  353.951072] RIP: 0033:0x455259
[  353.954261] RSP: 002b:00007fc943ad7c68 EFLAGS: 00000246 ORIG_RAX: 0000000000000001
[  353.961976] RAX: ffffffffffffffda RBX: 00007fc943ad86d4 RCX: 0000000000455259
[  353.969244] RDX: 00000000e78e624c RSI: 0000000020000040 RDI: 0000000000000014
[  353.976513] RBP: 000000000072c010 R08: 0000000000000000 R09: 0000000000000000
[  353.983779] R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
[  353.991051] R13: 00000000000006ca R14: 00000000006fd390 R15: 0000000000000002
[  354.000710] Dumping ftrace buffer:
[  354.004343]    (ftrace buffer empty)
[  354.008034] Kernel Offset: disabled
[  354.011650] Rebooting in 86400 seconds..
