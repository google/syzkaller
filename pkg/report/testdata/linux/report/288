TITLE: BUG: soft lockup in kvm_vcpu_release
TYPE: HANG

[ 1342.342232] watchdog: BUG: soft lockup - CPU#0 stuck for 123s! [syz-executor0:8009]
[ 1342.350104] Modules linked in:
[ 1342.353311] irq event stamp: 32790
[ 1342.356862] hardirqs last  enabled at (32789): [<ffffffff81007d91>] trace_hardirqs_on_thunk+0x1a/0x1c
[ 1342.366247] hardirqs last disabled at (32790): [<ffffffff81007dad>] trace_hardirqs_off_thunk+0x1a/0x1c
[ 1342.375718] softirqs last  enabled at (4938): [<ffffffff87e007ba>] __do_softirq+0x7ba/0xad8
[ 1342.384222] softirqs last disabled at (4873): [<ffffffff814ab9ff>] irq_exit+0x17f/0x1c0
[ 1342.393426] CPU: 0 PID: 8009 Comm: syz-executor0 Not tainted 4.19.0-rc2+ #230
[ 1342.400705] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
[ 1342.410083] RIP: 0010:__sanitizer_cov_trace_pc+0x20/0x50
[ 1342.434452] RSP: 0018:ffff8801b9257390 EFLAGS: 00000246 ORIG_RAX: ffffffffffffff13
[ 1342.442171] RAX: ffff8801940f4580 RBX: ffff8801b9257418 RCX: ffffffff817284a9
[ 1342.449440] RDX: 0000000000000000 RSI: ffffffff81728458 RDI: 0000000000000005
[ 1342.456711] RBP: ffff8801b9257390 R08: ffff8801940f4580 R09: ffffed003b5e5ba0
[ 1342.463980] R10: ffffed003b5e5ba0 R11: ffff8801daf2dd07 R12: ffffed003724ae90
[ 1342.471269] R13: 1ffff1003724ae7c R14: dffffc0000000000 R15: 0000000000000001
[ 1342.478545] FS:  000000000124c940(0000) GS:ffff8801dae00000(0000) knlGS:0000000000000000
[ 1342.486771] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 1342.492651] CR2: 0000000020fea800 CR3: 00000001c17e1000 CR4: 00000000001426f0
[ 1342.499927] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 1342.507203] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 1342.514471] Call Trace:
[ 1342.517069]  smp_call_function_single+0x258/0x660
[ 1342.546284]  vmx_vcpu_load+0x8a7/0x1030
[ 1342.587166]  kvm_arch_vcpu_load+0x247/0x970
[ 1342.606789]  vcpu_load+0x35/0x70
[ 1342.610160]  kvm_arch_destroy_vm+0x1f9/0x7c0
[ 1342.644514]  kvm_put_kvm+0x6c8/0xff0
[ 1342.676490]  kvm_vcpu_release+0x7b/0xa0
[ 1342.680470]  __fput+0x385/0xa30
[ 1342.714127]  ____fput+0x15/0x20
[ 1342.717411]  task_work_run+0x1e8/0x2a0
[ 1342.733866]  exit_to_usermode_loop+0x318/0x380
[ 1342.748873]  do_syscall_64+0x6be/0x820
[ 1342.782821]  entry_SYSCALL_64_after_hwframe+0x49/0xbe
[ 1342.788012] RIP: 0033:0x410c51
[ 1342.810143] RSP: 002b:0000000000a3fdc0 EFLAGS: 00000293 ORIG_RAX: 0000000000000003
[ 1342.817870] RAX: 0000000000000000 RBX: 0000000000000006 RCX: 0000000000410c51
[ 1342.825144] RDX: 0000000000000000 RSI: 0000000000730f10 RDI: 0000000000000005
[ 1342.832419] RBP: 0000000000000000 R08: ffffffffffffffff R09: ffffffffffffffff
[ 1342.839694] R10: 0000000000a3fcf0 R11: 0000000000000293 R12: 0000000000000007
[ 1342.846968] R13: 0000000000123610 R14: 0000000000000323 R15: badc0ffeebadface
[ 1342.854275] Sending NMI from CPU 0 to CPUs 1:
[ 1342.860797] NMI backtrace for cpu 1
[ 1342.860804] CPU: 1 PID: 8029 Comm: syz-executor4 Not tainted 4.19.0-rc2+ #230
[ 1342.860811] Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
[ 1342.860816] RIP: 0010:vmx_read_guest_seg_ar+0x1ff/0x270
[ 1342.860834] RSP: 0018:ffff8801c020edf0 EFLAGS: 00000807
[ 1342.860844] RAX: dffffc0000000000 RBX: 0000000000000002 RCX: ffffffff811c33b0
[ 1342.860850] RDX: 0000000000000000 RSI: ffffffff811c33be RDI: ffff8801c757eafc
[ 1342.860856] RBP: ffff8801c020ee18 R08: ffff8801c88a04c0 R09: fffff520026ac047
[ 1342.860862] R10: fffff520026ac047 R11: ffffc9001356023b R12: ffff8801c75790c0
[ 1342.860868] R13: 0000000000000800 R14: 0000000000000800 R15: 0000000000100000
[ 1342.860874] FS:  00007fae23f34700(0000) GS:ffff8801daf00000(0000) knlGS:0000000000000000
[ 1342.860879] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 1342.860885] CR2: 0000001b31d25000 CR3: 00000001bf9be000 CR4: 00000000001426e0
[ 1342.860891] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 1342.860897] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 1342.860901] Call Trace:
[ 1342.860905]  vmx_get_cpl+0x5b/0x90
[ 1342.860909]  kvm_arch_vcpu_put+0x9b/0x420
[ 1342.860913]  kvm_sched_out+0x91/0xb0
[ 1342.860917]  __schedule+0xf8c/0x1ed0
[ 1342.860958]  preempt_schedule_notrace+0x70/0x130
[ 1342.860962]  ___preempt_schedule_notrace+0x16/0x31
[ 1342.860967]  rcu_is_watching+0x23/0x30
[ 1342.860971]  rcu_read_lock+0x43/0x70
[ 1342.860975]  get_mem_cgroup_from_mm+0x8c/0x440
[ 1342.861014]  memcg_kmem_get_cache+0x1fc/0x9d0
[ 1342.861036]  kmem_cache_alloc+0x193/0x730
[ 1342.861050]  mmu_topup_memory_caches+0x2ec/0x390
[ 1342.861054]  kvm_mmu_load+0x21/0xfa0
[ 1342.861071]  vcpu_enter_guest+0x3dee/0x62e0
[ 1342.861143]  kvm_arch_vcpu_ioctl_run+0x375/0x16e0
[ 1342.861152]  kvm_vcpu_ioctl+0x72b/0x1150
[ 1342.861211]  do_vfs_ioctl+0x1de/0x1720
[ 1342.861272]  ksys_ioctl+0xa9/0xd0
[ 1342.861276]  __x64_sys_ioctl+0x73/0xb0
[ 1342.861280]  do_syscall_64+0x1b9/0x820
[ 1342.861318]  entry_SYSCALL_64_after_hwframe+0x49/0xbe
[ 1342.861322] RIP: 0033:0x457099
[ 1342.861339] RSP: 002b:00007fae23f33c78 EFLAGS: 00000246 ORIG_RAX: 0000000000000010
[ 1342.861349] RAX: ffffffffffffffda RBX: 00007fae23f346d4 RCX: 0000000000457099
[ 1342.861355] RDX: 0000000000000000 RSI: 000000000000ae80 RDI: 0000000000000005
[ 1342.861361] RBP: 00000000009300a0 R08: 0000000000000000 R09: 0000000000000000
[ 1342.861367] R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
[ 1342.861373] R13: 00000000004cf730 R14: 00000000004c59b9 R15: 0000000000000000
