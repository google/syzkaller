#
# requires: arch=riscv64
#

r0 = openat$kvm(0xffffffffffffff9c, &(0x7f0000000000), 0x0, 0x0)
r1 = ioctl$KVM_CREATE_VM(r0, AUTO, 0x0)
r2 = ioctl$KVM_CREATE_VCPU(r1, AUTO, 0x0)

#
# Test config reg.
#
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000001000002, &AUTO=0})
syz_kvm_assert_reg$riscv64(r2, 0x8030000001000002, 0)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000001000003, &AUTO=0})
syz_kvm_assert_reg$riscv64(r2, 0x8030000001000003, 0)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000001000004, &AUTO=0})
syz_kvm_assert_reg$riscv64(r2, 0x8030000001000004, 0)

#
# Test core reg.
#
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000002000000, &AUTO=0x80200000})
syz_kvm_assert_reg$riscv64(r2, 0x8030000002000000, 0x80200000)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x803000000200000a, &AUTO=0xdeadbeef})
syz_kvm_assert_reg$riscv64(r2, 0x803000000200000a, 0xdeadbeef)

#
# Test csr reg.
#
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000003000000, &AUTO=0x00006000})
syz_kvm_assert_reg$riscv64(r2, 0x8030000003000000, 0x00006000)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000003000004, &AUTO=0x80201000})
syz_kvm_assert_reg$riscv64(r2, 0x8030000003000004, 0x80201000)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000003000008, &AUTO=0x1000000000001})
syz_kvm_assert_reg$riscv64(r2, 0x8030000003000008, 0x1000000000001)

#
# Test fp_f/d reg.
#
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8020000005000000, &AUTO=0x3f800000})
syz_kvm_assert_reg$riscv64(r2, 0x8020000005000000, 0x3f800000)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8020000005000020, &AUTO=0x5})
syz_kvm_assert_reg$riscv64(r2, 0x8020000005000020, 0x5)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000006000000, &AUTO=0x3ff0000000000000})
syz_kvm_assert_reg$riscv64(r2, 0x8030000006000000, 0x3ff0000000000000)
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8020000006000020, &AUTO=0x1})
syz_kvm_assert_reg$riscv64(r2, 0x8020000006000020, 0x1)

#
# Test timer reg.
#
ioctl$KVM_SET_ONE_REG(r2, 0x4010aeac, &AUTO=@riscv64_config={0x8030000004000002, &AUTO=0x2000})
syz_kvm_assert_reg$riscv64(r2, 0x8030000004000002, 0x2000)

#
# Test reg list.
#
ioctl$KVM_GET_REG_LIST(r2, 0xc008aeb0, &AUTO={0xac, [0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0]})
